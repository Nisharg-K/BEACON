<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beacon Dashboard</title>
  <style>
    :root {
      --bg-1: #07111d;
      --bg-2: #111f36;
      --bg-3: #1c2f51;
      --accent: #00ffc8;
      --accent-2: #ffdb4d;
      --danger: #ff4d67;
      --text: #f6fbff;
      --muted: #c4d6eb;
      --glass: rgba(8, 20, 36, 0.7);
      --stroke: rgba(173, 231, 255, 0.35);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      overflow: hidden;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 520px at 15% -15%, #1f4d84 0%, transparent 54%),
        radial-gradient(800px 500px at 85% 120%, #173661 0%, transparent 60%),
        linear-gradient(145deg, var(--bg-1), var(--bg-2) 45%, var(--bg-3));
      transition: filter 300ms ease;
    }

    body.identity-open #main-shell {
      filter: blur(12px) saturate(0.9);
      transform: scale(0.98);
    }

    .shell {
      width: min(440px, 100%);
      transition: transform 300ms ease, filter 300ms ease;
    }

    .topbar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 12px;
    }

    .identity-toggle {
      width: 42px;
      height: 42px;
      border: 1px solid var(--stroke);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      display: grid;
      place-items: center;
      transition: transform 180ms ease, background 180ms ease;
    }

    .identity-toggle:hover,
    .identity-toggle:focus-visible {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.14);
      outline: none;
    }

    .card {
      border: 1px solid var(--stroke);
      border-radius: 24px;
      padding: 18px;
      background: var(--glass);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.45);
    }

    .hero {
      margin: 0 0 8px;
      font-size: clamp(1.6rem, 7vw, 2.35rem);
      line-height: 1.1;
      letter-spacing: 0.02em;
      color: var(--accent);
      text-transform: uppercase;
    }

    .subtitle {
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .identity-chip {
      margin-bottom: 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(0, 255, 200, 0.45);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      color: #beffe9;
      background: rgba(0, 255, 200, 0.11);
      min-height: 30px;
    }

    .action-wrap {
      position: relative;
    }

    .blast-btn {
      width: 100%;
      border: 0;
      border-radius: 18px;
      padding: 22px 18px;
      background:
        linear-gradient(160deg, #00ffc8, #11dfbf 38%, #00ba9f),
        radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.55), transparent 60%);
      color: #02231f;
      font-size: clamp(1.1rem, 4vw, 1.35rem);
      font-weight: 900;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      box-shadow: 0 14px 30px rgba(0, 255, 200, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: transform 140ms ease, filter 200ms ease, opacity 180ms ease;
      animation: pop-in 450ms cubic-bezier(.22,.98,.36,1) both;
    }

    .blast-btn:hover,
    .blast-btn:focus-visible {
      transform: translateY(-2px) scale(1.01);
      filter: saturate(1.08);
      outline: none;
    }

    .blast-btn:active {
      transform: translateY(1px) scale(0.99);
    }

    .blast-btn[disabled] {
      cursor: not-allowed;
      opacity: 0.85;
      color: #04241f;
    }

    .blast-btn.sending {
      color: var(--text);
      background: linear-gradient(180deg, #ff9c3d, #ff5d3d 55%, #d92f4e);
      animation: pulse 750ms ease-in-out infinite, shake 180ms linear infinite;
      box-shadow: 0 0 0 0 rgba(255, 93, 61, 0.5), 0 0 30px rgba(255, 93, 61, 0.7);
    }

    .energy-rings {
      pointer-events: none;
      position: absolute;
      inset: -10px;
      border-radius: 24px;
      opacity: 0;
    }

    .energy-rings.active {
      opacity: 1;
    }

    .energy-rings.active::before,
    .energy-rings.active::after {
      content: "";
      position: absolute;
      inset: 0;
      border: 2px solid rgba(255, 219, 77, 0.9);
      border-radius: 24px;
      animation: ring 900ms ease-out infinite;
    }

    .energy-rings.active::after {
      animation-delay: 300ms;
    }

    #status {
      margin-top: 14px;
      min-height: 48px;
      font-size: 0.95rem;
      color: var(--muted);
      display: flex;
      align-items: center;
    }

    #status.success {
      color: #bbffd6;
    }

    #status.error {
      color: #ffd1d9;
    }

    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 14px;
      background: rgba(0, 0, 0, 0.35);
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      transition: opacity 240ms ease;
    }

    body.identity-open .modal {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-card {
      width: min(430px, 100%);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      padding: 20px;
      background: linear-gradient(165deg, rgba(13, 33, 58, 0.96), rgba(8, 20, 36, 0.95));
      box-shadow: 0 20px 48px rgba(0, 0, 0, 0.5);
      transform: translateY(14px) scale(0.97);
      transition: transform 260ms ease;
    }

    body.identity-open .modal-card {
      transform: translateY(0) scale(1);
    }

    .modal h2 {
      margin: 0 0 8px;
      font-size: 1.35rem;
      color: var(--text);
    }

    .modal p {
      margin: 0 0 14px;
      color: var(--muted);
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option-btn {
      border: 1px solid rgba(125, 249, 255, 0.45);
      color: var(--text);
      background: rgba(255, 255, 255, 0.06);
      border-radius: 12px;
      padding: 13px 14px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
    }

    .option-btn:hover {
      transform: translateY(-1px) scale(1.01);
      background: rgba(125, 249, 255, 0.12);
      border-color: rgba(125, 249, 255, 0.8);
    }

    @keyframes pop-in {
      from { opacity: 0; transform: translateY(16px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 93, 61, 0.7), 0 0 24px rgba(255, 93, 61, 0.55); }
      50% { transform: scale(1.025); box-shadow: 0 0 0 12px rgba(255, 93, 61, 0), 0 0 40px rgba(255, 155, 77, 0.7); }
    }

    @keyframes shake {
      0% { filter: hue-rotate(0deg); }
      25% { transform: translateX(-1.5px); }
      50% { transform: translateX(1.5px); filter: hue-rotate(8deg); }
      75% { transform: translateX(-1.5px); }
      100% { filter: hue-rotate(0deg); }
    }

    @keyframes ring {
      from { transform: scale(0.94); opacity: 1; }
      to { transform: scale(1.08); opacity: 0; }
    }

    @media (max-width: 480px) {
      body {
        padding: 12px;
      }

      .card {
        border-radius: 20px;
        padding: 14px;
      }

      .blast-btn {
        padding: 20px 14px;
      }

      .modal-card {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <main class="shell" id="main-shell">
    <div class="topbar">
      <button id="change-identity-btn" class="identity-toggle" title="Change identity" aria-label="Change identity">ID</button>
    </div>
    <section class="card">
      <h1 class="hero">Summon The Team</h1>
      <p class="subtitle">Tap once to fire the beacon. Identity is saved on this device.</p>
      <div class="identity-chip" id="identity-chip">Identity: -</div>
      <div class="action-wrap">
        <div class="energy-rings" id="energy-rings"></div>
        <button id="summon-btn" class="blast-btn">Launch Beacon</button>
      </div>
      <div id="status" aria-live="polite"></div>
    </section>
  </main>

  <section class="modal" id="identity-modal" aria-hidden="true">
    <div class="modal-card">
      <h2>Confirm Your Identity</h2>
      <p>You Are :.</p>
      <div class="options">
        <button class="option-btn" data-identity="Noxxorp">Noxxorp</button>
        <button class="option-btn" data-identity="Rambo">Rambo</button>
        <button class="option-btn" data-identity="Rudy">Rudy</button>
      </div>
    </div>
  </section>

  <script>
    const IDENTITY_KEY = 'beacon_identity';
    const VALID_IDENTITIES = ['Noxxorp', 'Rambo', 'Rudy'];

    const statusEl = document.getElementById('status');
    const summonBtn = document.getElementById('summon-btn');
    const rings = document.getElementById('energy-rings');
    const chip = document.getElementById('identity-chip');
    const modal = document.getElementById('identity-modal');
    const changeBtn = document.getElementById('change-identity-btn');

    let activeIdentity = null;
    let isSending = false;

    function openIdentityModal() {
      document.body.classList.add('identity-open');
      modal.setAttribute('aria-hidden', 'false');
    }

    function closeIdentityModal() {
      document.body.classList.remove('identity-open');
      modal.setAttribute('aria-hidden', 'true');
    }

    function setIdentity(identity, persist) {
      activeIdentity = identity;
      chip.textContent = `Identity: ${identity}`;
      if (persist) {
        localStorage.setItem(IDENTITY_KEY, identity);
      }
      closeIdentityModal();
      statusEl.className = '';
      statusEl.textContent = 'Identity locked. Press Launch Beacon.';
    }

    async function sendMail() {
      if (!activeIdentity || isSending) return;

      isSending = true;
      summonBtn.disabled = true;
      summonBtn.classList.add('sending');
      rings.classList.add('active');
      summonBtn.textContent = 'Charging Beacon...';
      statusEl.className = '';
      statusEl.textContent = `Broadcasting as ${activeIdentity}...`;

      try {
        const res = await fetch('/api/send_mail', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ identity: activeIdentity })
        });

        const data = await res.json();
        if (!res.ok) {
          throw new Error(data.message || 'Failed to send summon.');
        }

        statusEl.className = 'success';
        statusEl.textContent = data.message || 'Summon sent.';
      } catch (error) {
        statusEl.className = 'error';
        statusEl.textContent = error.message || 'Failed to send summon.';
      } finally {
        isSending = false;
        summonBtn.disabled = false;
        summonBtn.classList.remove('sending');
        rings.classList.remove('active');
        summonBtn.textContent = 'Launch Beacon';
      }
    }

    summonBtn.addEventListener('click', sendMail);
    changeBtn.addEventListener('click', openIdentityModal);

    modal.querySelectorAll('[data-identity]').forEach((btn) => {
      btn.addEventListener('click', () => setIdentity(btn.dataset.identity, true));
    });

    const savedIdentity = localStorage.getItem(IDENTITY_KEY);
    if (VALID_IDENTITIES.includes(savedIdentity)) {
      setIdentity(savedIdentity, false);
    } else {
      chip.textContent = 'Identity: Not selected';
      openIdentityModal();
      statusEl.textContent = 'Choose identity to continue.';
    }
  </script>
</body>
</html>
